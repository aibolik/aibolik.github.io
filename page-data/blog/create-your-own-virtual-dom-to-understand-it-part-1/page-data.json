{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/create-your-own-virtual-dom-to-understand-it-part-1","result":{"data":{"contentfulBlogPost":{"title":"Create your own virtual DOM to understand it (Part 1)","slug":"create-your-own-virtual-dom-to-understand-it-part-1","showNewsletterPromotion":null,"show30dayReactPromotion":null,"publishDate":"1532552400000","content":[{"__typename":"ContentfulBlogPostCopy","id":"072e4e92-953f-5481-9a2b-87f2a8520ba3","copy":{"childMarkdownRemark":{"html":"<p>In this article I want to recap my experience creating own “virtual DOM”. Sounds too ambitiously? Probably, but it is not that complicated as you might think. As the title states, it will make sense when you create your own, rather than reading thousands of articles about it.</p>\n<p><em>Originally, I was inspired by the talk of <a href=\"https://medium.com/u/c3a0319fab53\">stefan judis</a> at Web Rebels 2018, so feel free to take a look at it <a href=\"https://youtu.be/kghSjWmNJyQ\">here</a>.</em></p>\n<p>This concept of <strong>Virtual DOM</strong> got popular back in 2013 when <a href=\"https://reactjs.org/blog/2013/06/05/why-react.html\">React was released</a>. Because of this concept ReactJS is one of super fast libraries for building UI. I’ll try to explain it in few sentences, then we will get to writing own one.</p>\n<blockquote>\n<p>Virtual DOM is the representation of DOM as an object. When changes to state of application are made, new Virtual DOM is compared(applying <a href=\"https://reactjs.org/docs/reconciliation.html\">**diffing algorithms</a>**) with DOM and only changes are reflected, not causing full re-rendering of DOM.</p>\n</blockquote>\n<p>Ok, here is a plan how we will create our virtual DOM.</p>\n<ol>\n<li>Create *hyperscript *function to render DOM — it is kinda <a href=\"https://reactjs.org/docs/jsx-in-depth.html\">JSX</a></li>\n<li>Create simple app with hyperscript</li>\n<li>Make our App dynamic and learn to render virtual DOM</li>\n<li>Implement diffing algorithm to see the power of virtual DOM</li>\n</ol>\n<h2>HyperScript implementation</h2>\n<p>If you ever worked with ReactJS you probably know what is JSX. It can be another topic for discussion, but shortly it transforms “HTML-like” syntax into JavaScript function calls, in React it is transferred as React.createElement. So, in this step our aim is to *recreate *this awesome function.</p>\n<p>Generally, it is the building block that creates virtual DOM. However, in this step I want to emphasize how we can build simple DOM with it and in further steps we will develop it to make virtual DOM.</p>\n<p>The inputs for this function are: *type of node, properties(a.k.a. attributes), children. *So here is a simple implementation of this function:</p>"}}},{"__typename":"ContentfulBlogPostImage","id":"0cf84e7c-3ccb-5423-b2b0-c1dc04a45ace","caption":"Implementation of **hyperscript **function, that constructs DOM given nodeName, attrs and children","image":{"resolutions":{"src":"//images.ctfassets.net/w1fxlmsi3y1l/1uf0RW6O88wUy6MeguAWOm/5b1e8832b30fad597a8ef8d6ceb4b08b/hyperscript.png?w=400&q=100","srcSet":"//images.ctfassets.net/w1fxlmsi3y1l/1uf0RW6O88wUy6MeguAWOm/5b1e8832b30fad597a8ef8d6ceb4b08b/hyperscript.png?w=400&h=254&q=100 1x,\n//images.ctfassets.net/w1fxlmsi3y1l/1uf0RW6O88wUy6MeguAWOm/5b1e8832b30fad597a8ef8d6ceb4b08b/hyperscript.png?w=600&h=382&q=100 1.5x,\n//images.ctfassets.net/w1fxlmsi3y1l/1uf0RW6O88wUy6MeguAWOm/5b1e8832b30fad597a8ef8d6ceb4b08b/hyperscript.png?w=800&h=509&q=100 2x,\n//images.ctfassets.net/w1fxlmsi3y1l/1uf0RW6O88wUy6MeguAWOm/5b1e8832b30fad597a8ef8d6ceb4b08b/hyperscript.png?w=1200&h=763&q=100 3x"}}},{"__typename":"ContentfulBlogPostCopy","id":"55debb67-abf1-501f-88f3-6958f2df43c1","copy":{"childMarkdownRemark":{"html":"<p>Firstly, It simply creates DOM element with *nodeName. *Secondly, sets its attributes, and last step to append child nodes with the check for text nodes.</p>\n<blockquote>\n<p><strong>Note:</strong> actually, we could go further and render children recursively, but I left this for later for simplicity reason.</p>\n</blockquote>\n<p>Here is how it can be used(from now on we will use <strong>*h *</strong>instead of <strong><em>hyperscript</em></strong>):</p>"}}},{"__typename":"ContentfulBlogPostImage","id":"7e2fd2b4-6e08-5781-b766-c2d4c1318aaa","caption":"Simple app that renders h1 element","image":{"resolutions":{"src":"//images.ctfassets.net/w1fxlmsi3y1l/3DO7Kkv6s0iqSqiAkyOsYc/a591a2b16f3d2e2eacd20cbe4580f85a/simple_app.png?w=400&q=100","srcSet":"//images.ctfassets.net/w1fxlmsi3y1l/3DO7Kkv6s0iqSqiAkyOsYc/a591a2b16f3d2e2eacd20cbe4580f85a/simple_app.png?w=400&h=355&q=100 1x"}}},{"__typename":"ContentfulBlogPostImage","id":"9281da52-adec-54e7-b46c-8d1d0a9e32e7","caption":"Result of calling App() function","image":{"resolutions":{"src":"//images.ctfassets.net/w1fxlmsi3y1l/3etAfLQOxic0eAmc0e0mi/19a7fd0f1710913e345eaa15c6c0644b/app_result.png?w=400&q=100","srcSet":"//images.ctfassets.net/w1fxlmsi3y1l/3etAfLQOxic0eAmc0e0mi/19a7fd0f1710913e345eaa15c6c0644b/app_result.png?w=400&h=232&q=100 1x"}}},{"__typename":"ContentfulBlogPostCopy","id":"bdb32f7d-be41-53c8-8979-b3a289c07889","copy":{"childMarkdownRemark":{"html":"<h3>Creating application with Hyperscript</h3>\n<p>Okay, we now can create simple application with the help of Hyperscript. Let’s create a bit more complex application than it was in previous step. Here is our newer <strong><em>App</em></strong> function.</p>"}}},{"__typename":"ContentfulBlogPostImage","id":"a56f1a30-0b28-5b0a-a9a9-1f10beb58eff","caption":"\"Complex application\" with hyperscript","image":{"resolutions":{"src":"//images.ctfassets.net/w1fxlmsi3y1l/75rzdTK2Sks6oWGooCUmK/b3bd74771bdafc504233e6b8f5b3bc39/app_with_h.png?w=400&q=100","srcSet":"//images.ctfassets.net/w1fxlmsi3y1l/75rzdTK2Sks6oWGooCUmK/b3bd74771bdafc504233e6b8f5b3bc39/app_with_h.png?w=400&h=291&q=100 1x,\n//images.ctfassets.net/w1fxlmsi3y1l/75rzdTK2Sks6oWGooCUmK/b3bd74771bdafc504233e6b8f5b3bc39/app_with_h.png?w=600&h=437&q=100 1.5x,\n//images.ctfassets.net/w1fxlmsi3y1l/75rzdTK2Sks6oWGooCUmK/b3bd74771bdafc504233e6b8f5b3bc39/app_with_h.png?w=800&h=582&q=100 2x"}}},{"__typename":"ContentfulBlogPostCopy","id":"0b7f7c16-9b29-512f-bfd4-dfe25fbb579b","copy":{"childMarkdownRemark":{"html":"<p>When the <strong>App</strong> is executed it creates a <em>div</em>, with two children: one rendering H1 heading, and the second one unordered list. Note that we pass <em>props</em> to our function and render <strong>props.list</strong> into unordered list. Let’s add some more rendering magic:</p>"}}},{"__typename":"ContentfulBlogPostImage","id":"0246c878-5742-58da-bf9a-ccb9a8f51a0e","caption":"Render the app with the state","image":{"resolutions":{"src":"//images.ctfassets.net/w1fxlmsi3y1l/6IFAAJixnaQmQkuQkgia6y/bd92f81132944bf09b6aeb328316ea6c/render.png?w=400&q=100","srcSet":"//images.ctfassets.net/w1fxlmsi3y1l/6IFAAJixnaQmQkuQkgia6y/bd92f81132944bf09b6aeb328316ea6c/render.png?w=400&h=355&q=100 1x,\n//images.ctfassets.net/w1fxlmsi3y1l/6IFAAJixnaQmQkuQkgia6y/bd92f81132944bf09b6aeb328316ea6c/render.png?w=600&h=532&q=100 1.5x,\n//images.ctfassets.net/w1fxlmsi3y1l/6IFAAJixnaQmQkuQkgia6y/bd92f81132944bf09b6aeb328316ea6c/render.png?w=800&h=709&q=100 2x"}}},{"__typename":"ContentfulBlogPostCopy","id":"ef824830-2b78-51d1-8710-0fbe8a3fcfcb","copy":{"childMarkdownRemark":{"html":"<p>Generally, we just want to render the output of <strong>App</strong> function(that is valid DOM) into the body of document giving the state that contains emojis list.</p>"}}},{"__typename":"ContentfulBlogPostImage","id":"bab0c355-bf0e-5490-a183-ba31bde13453","caption":"Result of our work","image":{"resolutions":{"src":"//images.ctfassets.net/w1fxlmsi3y1l/4TgXDb3lF6WOoOceOGoeKg/97b2396b4abd8a633a1e1259b0e9095c/static_app.png?w=400&q=100","srcSet":"//images.ctfassets.net/w1fxlmsi3y1l/4TgXDb3lF6WOoOceOGoeKg/97b2396b4abd8a633a1e1259b0e9095c/static_app.png?w=400&h=252&q=100 1x"}}},{"__typename":"ContentfulBlogPostCopy","id":"3c78ebc4-0a24-54c4-b1df-71905aae0d2b","copy":{"childMarkdownRemark":{"html":"<p><em>It wasn’t that hard. Is it?</em> Let’s add some dynamic content, and add random emoji every 1 second this way we can see how our app renders.</p>"}}},{"__typename":"ContentfulBlogPostImage","id":"db7c61a7-08e7-513e-a713-aab9bacf4759","caption":null,"image":{"resolutions":{"src":"//images.ctfassets.net/w1fxlmsi3y1l/18Pb4RUaIqOYSCWgCOo2W8/6fc4042cd665bf66af1a1448483c6944/dynamic_app_1.png?w=400&q=100","srcSet":"//images.ctfassets.net/w1fxlmsi3y1l/18Pb4RUaIqOYSCWgCOo2W8/6fc4042cd665bf66af1a1448483c6944/dynamic_app_1.png?w=400&h=271&q=100 1x,\n//images.ctfassets.net/w1fxlmsi3y1l/18Pb4RUaIqOYSCWgCOo2W8/6fc4042cd665bf66af1a1448483c6944/dynamic_app_1.png?w=600&h=407&q=100 1.5x,\n//images.ctfassets.net/w1fxlmsi3y1l/18Pb4RUaIqOYSCWgCOo2W8/6fc4042cd665bf66af1a1448483c6944/dynamic_app_1.png?w=800&h=542&q=100 2x"}}},{"__typename":"ContentfulBlogPostImage","id":"4e41417c-e1b1-51da-b486-b6ac744abf4b","caption":"DOM is fully re-rendering every 1 second","image":{"resolutions":{"src":"//images.ctfassets.net/w1fxlmsi3y1l/5ohjBgY7dKiW8MeEocSkiU/3c304fce334246357cf05db29ff2adce/dynamic_app_result_1.gif?w=400&q=100","srcSet":"//images.ctfassets.net/w1fxlmsi3y1l/5ohjBgY7dKiW8MeEocSkiU/3c304fce334246357cf05db29ff2adce/dynamic_app_result_1.gif?w=400&h=227&q=100 1x,\n//images.ctfassets.net/w1fxlmsi3y1l/5ohjBgY7dKiW8MeEocSkiU/3c304fce334246357cf05db29ff2adce/dynamic_app_result_1.gif?w=600&h=341&q=100 1.5x"}}},{"__typename":"ContentfulBlogPostCopy","id":"25bee8cb-0652-5797-9ef7-e22db23107b5","copy":{"childMarkdownRemark":{"html":"<h3>Implement vDOM rendering</h3>\n<p>Okay, now we have dynamic app done with <em>hyperscript</em> let’s move on to actual virtual DOM and its implementation. First of all we need to change our <em>hyperscript</em> function. Now it should not create real DOM, but instead it rather should create virtual DOM. So, given <em>nodeName,</em> <em>attributes</em> and <em>children</em> we just a create an object with corresponding keys. Thanks to ES6 we can do this in one line:</p>"}}},{"__typename":"ContentfulBlogPostImage","id":"2e43b5b2-999d-50a3-86d0-bd4bcecb01c1","caption":"hyperscript function that returns virtual DOM","image":{"resolutions":{"src":"//images.ctfassets.net/w1fxlmsi3y1l/6l0CVLLD1eWo2okkWIomU6/f7340c573ba8de28ca58e4b1cfd36708/hyperscript_recreated.png?w=400&q=100","srcSet":"//images.ctfassets.net/w1fxlmsi3y1l/6l0CVLLD1eWo2okkWIomU6/f7340c573ba8de28ca58e4b1cfd36708/hyperscript_recreated.png?w=400&h=73&q=100 1x,\n//images.ctfassets.net/w1fxlmsi3y1l/6l0CVLLD1eWo2okkWIomU6/f7340c573ba8de28ca58e4b1cfd36708/hyperscript_recreated.png?w=600&h=109&q=100 1.5x,\n//images.ctfassets.net/w1fxlmsi3y1l/6l0CVLLD1eWo2okkWIomU6/f7340c573ba8de28ca58e4b1cfd36708/hyperscript_recreated.png?w=800&h=145&q=100 2x,\n//images.ctfassets.net/w1fxlmsi3y1l/6l0CVLLD1eWo2okkWIomU6/f7340c573ba8de28ca58e4b1cfd36708/hyperscript_recreated.png?w=1200&h=218&q=100 3x"}}},{"__typename":"ContentfulBlogPostCopy","id":"34573c86-90bc-51d5-a1c8-370b22f21aa1","copy":{"childMarkdownRemark":{"html":"<p>We have a virtual DOM and if we execute the App function with same emojis list we get something like this(logged in console):</p>"}}},{"__typename":"ContentfulBlogPostImage","id":"ca55e5bf-e602-5d74-a777-b5628673a168","caption":"\"Virtual DOM\" of out application","image":{"resolutions":{"src":"//images.ctfassets.net/w1fxlmsi3y1l/4Vjf3xd6VWaAc4UcMe42yw/acbc4f6a7059f056614f179b8a97e1ac/console_log.png?w=400&q=100","srcSet":"//images.ctfassets.net/w1fxlmsi3y1l/4Vjf3xd6VWaAc4UcMe42yw/acbc4f6a7059f056614f179b8a97e1ac/console_log.png?w=400&h=220&q=100 1x,\n//images.ctfassets.net/w1fxlmsi3y1l/4Vjf3xd6VWaAc4UcMe42yw/acbc4f6a7059f056614f179b8a97e1ac/console_log.png?w=600&h=330&q=100 1.5x"}}},{"__typename":"ContentfulBlogPostCopy","id":"0575f3eb-4e63-54cd-b744-d5cf59b15c9f","copy":{"childMarkdownRemark":{"html":"<p>Pretty similar to DOM. Now let’s create a function that renders virtual DOM into real DOM. As you might have guessed it should take virtual Node as a parameter. Here it is:</p>"}}},{"__typename":"ContentfulBlogPostImage","id":"793a239a-eec6-50d1-9378-6075d36c5c3c","caption":"This function renders real DOM(DOM Node) given virtual DOM(Node)","image":{"resolutions":{"src":"//images.ctfassets.net/w1fxlmsi3y1l/28YoFRLMR6Aqms6Yu4QyKg/13389766784e0e50abb9875cc807ffbb/renderNode.png?w=400&q=100","srcSet":"//images.ctfassets.net/w1fxlmsi3y1l/28YoFRLMR6Aqms6Yu4QyKg/13389766784e0e50abb9875cc807ffbb/renderNode.png?w=400&h=278&q=100 1x,\n//images.ctfassets.net/w1fxlmsi3y1l/28YoFRLMR6Aqms6Yu4QyKg/13389766784e0e50abb9875cc807ffbb/renderNode.png?w=600&h=416&q=100 1.5x,\n//images.ctfassets.net/w1fxlmsi3y1l/28YoFRLMR6Aqms6Yu4QyKg/13389766784e0e50abb9875cc807ffbb/renderNode.png?w=800&h=555&q=100 2x"}}},{"__typename":"ContentfulBlogPostCopy","id":"ddabcefd-79d4-5203-afe4-727b38ef95d2","copy":{"childMarkdownRemark":{"html":"<p>Let me explain what it does step by step:</p>\n<ol>\n<li>Using destructuring we retrieve nodeName, attributes and children of virtual Node</li>\n<li>If vnode is text(we can check it by <em>vnode.split</em>) then we return text Node</li>\n<li>Otherwise we create an element with nodeName and set its attributes from <em>attributes</em> object</li>\n<li>Do the same thing for children if any</li>\n</ol>\n<p>Now, remember our <em>render</em> function that rendered our <strong>App</strong>? We just need to change a little bit to make it work:</p>"}}},{"__typename":"ContentfulBlogPostImage","id":"62c706f6-6cda-5338-bb69-50eaded56def","caption":null,"image":{"resolutions":{"src":"//images.ctfassets.net/w1fxlmsi3y1l/1OsHdXc4DCMuoEww0Cue2i/653df65a5c6de97b8b5f59920063e39c/render_node.png?w=400&q=100","srcSet":"//images.ctfassets.net/w1fxlmsi3y1l/1OsHdXc4DCMuoEww0Cue2i/653df65a5c6de97b8b5f59920063e39c/render_node.png?w=400&h=185&q=100 1x,\n//images.ctfassets.net/w1fxlmsi3y1l/1OsHdXc4DCMuoEww0Cue2i/653df65a5c6de97b8b5f59920063e39c/render_node.png?w=600&h=278&q=100 1.5x,\n//images.ctfassets.net/w1fxlmsi3y1l/1OsHdXc4DCMuoEww0Cue2i/653df65a5c6de97b8b5f59920063e39c/render_node.png?w=800&h=370&q=100 2x"}}},{"__typename":"ContentfulBlogPostCopy","id":"60fe5bda-e576-559d-ae14-3fc977225a1b","copy":{"childMarkdownRemark":{"html":"<blockquote>\n<p>This article became a bit longer than I thought, so I decided to break into two parts.</p>\n</blockquote>\n<p>So, let’s recap this. We created a <strong>hyperscript —</strong> <em>virtual DOM factory</em>, <strong>renderNode</strong> — <em>that turns virtual DOM into DOM element</em> and a <em>function component</em> <strong>App</strong> that creates whole page. The result is now the same as we did it before without virtual DOM, but now we have more control. In the next article we will explore what makes React(and virtual DOM) so fast.</p>\n<p><em>You can look up all steps in my <a href=\"http://bit.ly/2NKXH0V\">GitHub repository</a>. You can find these steps in branches.</em></p>\n<p>In the next article we will implement simple <strong>diffing algorithm</strong>, that will make our app faster and you’ll be able to see it action.</p>"}}}]}},"pageContext":{"slug":"create-your-own-virtual-dom-to-understand-it-part-1"}},"staticQueryHashes":["3649515864"]}